---
title: Низкоуровневые настройки
sidebar_position: 6
---

:::info

В этой статье рассказывается об AdGuard для Android — многофункциональном блокировщике рекламы, который защищает ваше устройство на системном уровне. Чтобы увидеть, как он работает, [скачайте приложение AdGuard](https://adguard.com/download.html?auto=true)

:::

## Как получить доступ к Низкоуровневым настройкам

:::caution

Изменение *Низкоуровневых настроек* может вызвать проблемы с производительностью AdGuard, нарушить подключение к интернету или поставить под угрозу вашу безопасность и конфиденциальность. Заходите в этот раздел, только если вы уверены в своих действиях или наша служба поддержки попросила вас об этом.

:::

Чтобы перейти к *Низкоуровневым настройкам*, откройте приложение AdGuard и коснитесь значка шестерёнки в правом нижнем углу экрана. Затем выберите *Общие → Дополнительные → Низкоуровневые настройки*.

## Низкоуровневые настройки

В AdGuard 4.0 для Android мы полностью переработали низкоуровневые настройки: разделили их на тематические блоки, сделали более понятными, добавили проверку введённых значений и другие меры предосторожности, избавились от одних настроек и добавили другие.

### DNS-защита

#### Резервные серверы

Здесь вы можете указать резервный DNS-резолвер, который будет использоваться, если настроенный сервер недоступен. Существует три варианта: *Автоматический DNS*, *Отсутствует* и *Пользовательский DNS*. Если резервный сервер не указан, то будет использоваться *Aвтоматический DNS* — системный DNS-сервер или AdGuard DNS. *Отсутствует* означает отсутствие запасного варианта. Выбирая *Пользовательский DNS*, вы можете использовать IPv4- и IPv6-адреса в качестве upstream-серверов.

#### Резервные домены

Здесь вы можете перечислить домены, которые будут перенаправлены напрямую на резервные апстримы, если они существуют.

#### Обнаруживать search-домены

Если эта опция включена, AdGuard будет определять поисковые домены и автоматически перенаправлять их на резервные upstream-серверы.

#### Bootstrap DNS-серверы

Загрузочный DNS для серверов DoH, DoT и DoQ. По умолчанию используется *Автоматический DNS* — системный DNS-сервер или AdGuard DNS. Выбирая *Пользовательский DNS*, вы можете использовать IPv4- и IPv6-адреса в качестве upstream-серверов.

#### Режим блокировки для правил adblock

Здесь можно указать тип ответа для доменов, блокируемых правилами DNS на основе синтаксиса правил adblock (например, `||example.org^`).

- Отвечать кодом REFUSED (по умолчанию)
- Отвечать кодом NXDOMAIN
- Отвечать пользовательским IP-адресом (здесь можно указать адреса IPv4 и IPv6)

#### Режим блокировки для правил hosts

Здесь можно указать тип ответа для доменов, блокируемых правилами DNS на основе синтаксиса правил hosts (например, `<ip> <domain> 0.0.0.0 example.com`).

- Отвечать кодом REFUSED
- Отвечать кодом NXDOMAIN
- Отвечать пользовательским IP-адресом (здесь можно указать адреса IPv4 и IPv6) — по умолчанию

#### Время ожидания DNS-запроса

В этом поле вы можете указать время в миллисекундах, в течение которого AdGuard будет ждать ответа от выбранного DNS-сервера, прежде чем прибегнуть к резервному. Если вы не заполните это поле или введёте недопустимое значение, будет использовано значение 5000.

#### Заблокированный ответ TTL

Здесь вы можете указать значение TTL (время жизни пакета данных в протоколе IP), которое будет возвращено в ответ на заблокированный запрос.

#### Размер кеша DNS

Здесь вы можете указать максимальное количество кешируемых ответов. Значение по умолчанию — 1000.

#### Блокировка ECH

Если опция включена, AdGuard удаляет из DNS-ответов параметры Encrypted Client Hello.

#### Игнорировать недоступный исходящий прокси-сервер

Включите эту функцию, чтобы AdGuard отправлял DNS-запросы напрямую, если исходящий прокси недоступен.

#### Пробовать HTTP/3 для upstream-серверов DNS-over-HTTPS

По умолчанию все DNS-запросы для DNS-over-HTTPS отправляются по протоколу HTTP/2. Если эта опция включена, AdGuard использует HTTP/3 для ускорения разрешения DNS-запросов для upstream-серверов DoH.

#### Отвечать на ошибку кодом SERVFAIL

После включения этой функции AdGuard отправляет клиенту ответ SERVFAIL, если все upstream-серверы, включая резервные, не отвечают. Если эта настройка отключена, ответ клиенту не отправляется.

#### Использовать резервный сервер для нерезервных доменов

Включите эту функцию, если хотите, чтобы AdGuard использовал резервный upstream-сервер для всех доменов. В противном случае резервный сервер будет использоваться только для резервных и поисковых доменов, если соответствующий параметр включён.

#### Проверять upstream-серверы DNS

Включите, чтобы AdGuard мог проверять upstream-серверы DNS перед добавлением или обновлением пользовательских DNS-серверов.

### Фильтрация

#### Записывать HAR

Здесь вы можете включить захват файла HAR. Используйте его только для целей отладки! Если настройка включена, AdGuard создаст папку har в кеш-директории приложения. Она будет содержать информацию обо всех отфильтрованных HTTP-запросах в формате HAR 1.2, и её можно будет проанализировать с помощью программы Fiddler.

### HTTPS-фильтрация

#### Encrypted Client Hello

У каждого зашифрованного интернет-соединения есть незашифрованная часть. Это самый первый пакет, который содержит имя сервера, к которому вы подключаетесь. Технология Encrypted Client Hello должна решить эту проблему и зашифровать последний бит незашифрованной информации. Чтобы воспользоваться ей, включите опцию *Использовать Encrypted Client Hello*. Она использует локальный DNS-прокси для поиска ECH-конфигурации для домена. Если она найдена, пакет ClientHello будет зашифрован.

#### Проверка OCSP

Если эта опция включена, она запускает асинхронные проверки OCSP, чтобы проверить, не отозван ли SSL/TLS-сертификат сайта.

Если проверка OCSP завершается в течение минимального тайм-аута, AdGuard немедленно заблокирует соединение, если сертификат отозван, или установит соединение, если сертификат действителен.

Если проверка занимает слишком много времени, AdGuard установит соединение и продолжит проверку в фоновом режиме. Если сертификат отозван, текущие и будущие подключения к домену будут заблокированы.

#### Перенаправлять запросы DNS-over-HTTPS

Если эта опция включена, то запросы DNS-over-HTTPS будут перенаправляться на модуль DNS-защиты. Для сохранения конфиденциальности мы рекомендуем отключить резервные upstream-серверы и использовать только зашифрованные DNS-серверы.

### Исходящий прокси

#### Показывать настройку «Фильтровать DNS-запросы»

Когда эта функция включена, в разделе *Настройки ➝ Фильтрация ➝ Сеть ➝ Прокси ➝ Прокси-сервер ➝ Добавить прокси-сервер* появляется опция *Фильтровать DNS-запросы*. Включив её, можно фильтровать DNS-запросы, проходящие через прокси-сервер.

### Защита

#### Диапазоны портов

Здесь вы можете указать диапазоны портов, которые должны быть отфильтрованы.

#### Фиксировать удаление HTML-элементов

Если этот параметр включён, AdGuard записывает заблокированные HTML-элементы в журнал фильтрации.

#### Отладка скриптлетов

Если вам нужно активировать отладку скриптлетов, включите эту функцию. Тогда в журнале браузера будут сообщения о том, что были применены правила скриптлетов.

#### Исключённые приложения

Здесь вы можете перечислить имена пакетов и UID, которые вы хотите исключить из защиты AdGuard.

#### Пакеты для обхода QUIC

Здесь вы можете указать имена пакетов, для которых AdGuard должен обходить трафик QUIC.

#### Перенастраивать Автоматический прокси при изменении сети

Включите этот параметр, если вы хотите, чтобы при подключении устройства к другой сети защита перезапускалась для перенастройки автоматического прокси. Этот параметр влияет на работу приложения только в том случае, если текущий режим маршрутизации — Автоматический прокси.

#### Фильтрация IPv6

Фильтрует сети IPv6 при наличии IPv6-интерфейсов.

#### Диапазоны IPv4-адресов, исключённые из фильтрации

Фильтрация для диапазонов IPv4, перечисленных в данном разделе, будет отключена.

#### Диапазоны IPv6-адресов, исключённые из фильтрации

Фильтрация для диапазонов IPv6, перечисленных в этом разделе, будет отключена.

#### TCP keepalive для исходящих сокетов

Если эта опция включена, AdGuard отправляет проверку активности через указанный период времени, чтобы убедиться, что TCP-соединение активно. Здесь вы можете указать время простоя проверки активности TCP перед запуском проверок активности и время между проверками активности для неотвечающего узла.

После заданного системой количества неудачных попыток получить ответ от сервера система автоматически закрывает TCP-соединение.

### Настройки локального VPN

#### Время ожидания для остановленного VPN

Здесь вы можете установить время задержки в миллисекундах, прежде чем AdGuard попытается восстановить VPN-защиту после её отзыва сторонним VPN-приложением или удалением VPN-профиля. Значение по умолчанию — 5000 мс.

#### Задержка для восстановления отключённого VPN

Здесь вы можете установить время задержки в миллисекундах, прежде чем AdGuard перенесёт восстановление VPN-защиты после того, как она была отозвана сторонним VPN-приложением или путём удаления VPN-профиля. Значение по умолчанию — 5000 мс.

#### MTU

Здесь вы можете установить максимальное значение передачи данных MTU через VPN. Рекомендуемый диапазон: 1500–1900 байт.

#### Автоматически возобновлять работу VPN

Если эта функция включена, она автоматически повторно включает локальный VPN AdGuard после того, как он был отключён из-за отсутствия сети, модема или режима низкого энергопотребления.

#### Захват пакетов (PCAP)

Если эта опция включена, то AdGuard создаст специальный файл с именем `timestamp.pcap` (например, 1682599851461.pcap). Он содержит все сетевые пакеты, передаваемые через VPN. Этот файл находится в папке кэша приложения и может быть проанализирован с помощью программы Wireshark.

#### Включить шлюз Wi-Fi в маршруты VPN

Если вы хотите, чтобы IP-адреса шлюза добавлялись к VPN-маршрутам при подключении к сети Wi-Fi, включите эту функцию.

#### IPv4-адрес

Здесь вы можете ввести IP-адрес, который будет использоваться для создания интерфейса TUN. По умолчанию это `172.18.11.218`.

#### Принудительно маршрутизировать LAN IPv4

Если эта опция включена, AdGuard фильтрует все LAN-соединения, включая трафик локальной сети IPv4, даже если включена опция *Маршрутизировать все IPv4-подключения в локальной сети*.

#### Маршрутизировать все IPv4-подключения в локальной сети

После включения этой опции AdGuard исключает из фильтрации LAN-соединения для простых сетей. Может не работать для сложных сетей. Работает только при отключённой опции *Принудительно маршрутизировать LAN IPv4*.

#### IPv6-адрес

Здесь вы можете ввести IP-адрес, который будет использоваться для создания интерфейса TUN. По умолчанию это `2001:db8:ad:0:ff::`.

### Разное

#### Обнаруживать Samsung Pay

Корейские пользователи могут столкнуться с проблемами с Samsung Pay при включённом AdGuard. Активируйте эту функцию, чтобы приостановить защиту AdGuard и беспрепятственно пользоваться приложением Samsung Pay.
